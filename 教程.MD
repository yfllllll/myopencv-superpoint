编译步骤
1. 准备ONNX Runtime依赖
# 下载ONNX Runtime (如果还没有的话)  
wget https://github.com/microsoft/onnxruntime/releases/download/v1.22.0/onnxruntime-linux-x64-gpu-1.22.0.tgz
tar -xzvf onnxruntime-linux-x64-gpu-1.22.0.tgz

export ONNXRUNTIME_ROOT_PATH=/root/onnxruntime-linux-x64-gpu-1.22.0
export ONNXRUNTIME_LIBRARIES=/root/onnxruntime-linux-x64-gpu-1.22.0/lib
export ONNXRUNTIME_INCLUDE_DIRS=/root/onnxruntime-linux-x64-gpu-1.22.0/include
export LD_LIBRARY_PATH=$ONNXRUNTIME_LIBRARIES:$LD_LIBRARY_PATH
export INCLUDE_PATH=$ONNXRUNTIME_INCLUDE_DIRS:$INCLUDE_PATH
export C_INCLUDE_PATH=$ONNXRUNTIME_INCLUDE_DIRS:$C_INCLUDE_PATH
export CPLUS_INCLUDE_PATH=$ONNXRUNTIME_INCLUDE_DIRS:$CPLUS_INCLUDE_PATH
  

# 配置CMake，启用ONNX Runtime支持  
#Python库检测失败是Python绑定构建中的常见问题 cmake/OpenCVDetectPython.cmake:178-203。在conda环境中，有时需要手动指定库路径，因为CMake的自动检测可能无法正确找到conda安装的Python开发文件, 可以手动指定Python库路径,在本例中实际指定-DPYTHON3_LIBRARY 和 -DPYTHON3_INCLUDE_DIR， 使用静态编译的话需要加上-DBUILD_SHARED_LIBS=OFF
不需要的话可以不加-DBUILD_SHARED_LIBS=OFF

mkdir build
cd build
cmake -DCMAKE_CXX_STANDARD=17 -DBUILD_opencv_python3=ON -DBUILD_opencv_python_bindings_generator=ON -DOPENCV_PYTHON3_VERSION="" -DOPENCV_GENERATE_PKGCONFIG=ON -DCMAKE_BUILD_TYPE=Release -DWITH_ONNXRUNTIME=ON -DPYTHON3_LIBRARY=/root/miniconda3/lib/libpython3.12.so -DPYTHON3_INCLUDE_DIR=/root/miniconda3/include/python3.12 ..



3. 编译OpenCV
# 编译 (使用多线程加速)  
make -j12
  
# 安装
make install

# 安装python绑定
cd python_loader
pip install .

#更新库，要不然import cv2会报错
conda install -c conda-forge libstdcxx-ng

4. 验证编译结果
#include <opencv2/opencv.hpp>  
#include <opencv2/superpoint.hpp>  
#include <opencv2/stitching/detail/lightglue.hpp>  
  
int main() {  
    // 测试SuperPoint创建  
    auto superpoint = cv::SuperPoint::create("/root/weights/superpoint.onnx");  
      
    // 测试LightGlue创建    
    auto lightglue = cv::detail::LightGlue::create("/root/weights/superpoint_lightglue.onnx");  
      
    std::cout << "SuperPoint and LightGlue integration successful!" << std::endl;  
    return 0;  
}

<!-- g++ -std=c++17 test.cpp -o test \
    `pkg-config --cflags --libs opencv4` \
    -L/root/onnxruntime-linux-x64-gpu-1.22.0/lib \
    -lonnxruntime -->


g++ -std=c++17 -DHAVE_ONNXRUNTIME -o test test.cpp \
    `pkg-config --cflags --libs opencv4` \
    -L/root/onnxruntime-linux-x64-gpu-1.22.0/lib \
    -lonnxruntime
# 运行测试程序
./test ./test_imgs

5. Python测试
python
import cv2


#python 拼接库使用，使用跟这个配套的https://github.com/yfllllll/stitching.git仓库代码
git clone https://github.com/yfllllll/stitching.git
cd stitching
python test_sl.py
